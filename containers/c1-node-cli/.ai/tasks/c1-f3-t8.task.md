# Task 8 for Plan c1-f3

Implement log filtering and querying capabilities

**Layer**: domain  
**Status**: not-started

### Reference

- [Feature Blueprint](/docs/f3-logging.blueprint.md)
- [Implementation Plan](/containers/c1-node-cli/docs/f3-logging.plan.md)
- [Language coding rules](/containers/c1-node-cli/.ai/rules/0-typescript.rules.md)  
- [Node CLI rules](/containers/c1-node-cli/.ai/rules/1-node-cli.rules.md)
- [Domain Layer rules](/containers/c1-node-cli/.ai/rules/3-domain-layer.rules.md)

## Instructions

- `src/domain/logger/logQuery.type.ts` : Define query builder types
  - Create an interface `LogQueryBuilder` with fluent methods:
    - `level(level: LogLevel | LogLevel[]): LogQueryBuilder` - Filter by log level
    - `timeRange(startTime: number, endTime: number): LogQueryBuilder` - Filter by time range
    - `correlation(correlationId: string): LogQueryBuilder` - Filter by correlation ID
    - `search(text: string): LogQueryBuilder` - Text search in messages
    - `limit(count: number): LogQueryBuilder` - Limit result count
    - `offset(count: number): LogQueryBuilder` - Skip initial results
    - `sort(field: string, direction?: 'asc' | 'desc'): LogQueryBuilder` - Sort results
    - `build(): LogQueryCriteria` - Build the final query criteria
  - Export any necessary additional types

- `src/domain/logger/logQuery.util.ts` : Implement query builder
  - Create a function `createLogQueryBuilder(): LogQueryBuilder` that returns a new query builder
  - Implement the LogQueryBuilder interface with all methods
  - Create helper functions for query execution:
    - `executeQuery(repository: LogRepository, criteria: LogQueryCriteria): Promise<LogEntry[]>`
    - `countQueryResults(repository: LogRepository, criteria: LogQueryCriteria): Promise<number>`

- `src/domain/logger/logFilter.util.ts` : Implement filtering utilities
  - Create a function `filterByLevel(entries: LogEntry[], level: LogLevel | LogLevel[]): LogEntry[]`
  - Implement `filterByTimeRange(entries: LogEntry[], startTime: number, endTime: number): LogEntry[]`
  - Create `filterByCorrelationId(entries: LogEntry[], correlationId: string): LogEntry[]`
  - Implement `searchInMessages(entries: LogEntry[], searchText: string): LogEntry[]`
  - Create a function `applyPagination(entries: LogEntry[], offset?: number, limit?: number): LogEntry[]`
  - Implement `sortEntries(entries: LogEntry[], field: string, direction: 'asc' | 'desc'): LogEntry[]`

- `src/domain/logger/logSearch.ts` : Implement search functionality
  - Create a function `createTextSearchIndex(entries: LogEntry[]): any` for efficient text search
  - Implement `searchLogEntries(entries: LogEntry[], query: string): LogEntry[]` for text search
  - Create a function `rankSearchResults(entries: LogEntry[], query: string): LogEntry[]` for relevance sorting

- `src/domain/logger/index.ts` : Update the barrel file
  - Export all query and filter utilities

> End of programming instructions for task 8. 