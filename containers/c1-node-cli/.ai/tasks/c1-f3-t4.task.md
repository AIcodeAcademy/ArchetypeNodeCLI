# Task 4 for Plan c1-f3

Implement log rotation and retention policies

**Layer**: system  
**Status**: not-started

### Reference

- [Feature Blueprint](/docs/f3-logging.blueprint.md)
- [Implementation Plan](/containers/c1-node-cli/docs/f3-logging.plan.md)
- [Language coding rules](/containers/c1-node-cli/.ai/rules/0-typescript.rules.md)  
- [Node CLI rules](/containers/c1-node-cli/.ai/rules/1-node-cli.rules.md)
- [System Layer rules](/containers/c1-node-cli/.ai/rules/2-system-layer.rules.md)

## Instructions

- `src/system/logger/logRotation.type.ts` : Define rotation and retention types
  - Create a type `RotationStrategy` as a union of string literals ('size', 'time', 'none')
  - Define an interface `RotationOptions` with properties:
    - `strategy: RotationStrategy`
    - `maxSize?: number` (in bytes)
    - `maxFiles?: number`
    - `interval?: string` (e.g., 'daily', 'hourly')
    - `compress?: boolean`
  - Define a constant `DEFAULT_ROTATION_OPTIONS` with reasonable defaults

- `src/system/logger/logRotation.util.ts` : Implement rotation utilities
  - Create a function `shouldRotateBySize(filePath: string, options: RotationOptions): Promise<boolean>`
  - Implement a function `shouldRotateByTime(filePath: string, options: RotationOptions): Promise<boolean>`
  - Create a function `rotateLogFile(filePath: string, options: RotationOptions): Promise<string>` that returns new file path
  - Implement a function `compressLogFile(filePath: string): Promise<void>` for archiving rotated logs
  - Create a function `enforceRetentionPolicy(logDir: string, options: RotationOptions): Promise<void>` to clean up old logs

- `src/system/logger/rotatingFileLogWriter.util.ts` : Implement rotating file log writer
  - Create a function `createRotatingFileLogWriter(options: LogWriterOptions & RotationOptions): LogWriter`
  - Extend the file log writer to check rotation conditions before each write
  - Implement automatic file rotation based on configured strategy
  - Add support for compression and cleanup

- `src/system/logger/index.ts` : Update the barrel file
  - Export all rotation types and utilities

> End of programming instructions for task 4. 