# Task 5 for Plan c1-f4

Create a command registry service to store, retrieve, and manage available commands.

**Layer**: domain  
**Status**: not-started

### Reference

- [Feature Blueprint](/docs/f4-command-handling.blueprint.md)
- [Implementation Plan](/containers/c1-node-cli/docs/f4-command-handling.plan.md)
- [Language coding rules](/containers/c1-node-cli/.ai/rules/0-typescript.rules.md)  
- [Node CLI rules](/containers/c1-node-cli/.ai/rules/1-node-cli.rules.md)
- [Domain Layer rules](/containers/c1-node-cli/.ai/rules/3-domain-layer.rules.md)

## Instructions

### Create Command Registry Interface

`src/domain/commandRegistry.service.ts`:
- Import the Command type from `../system/command.types.ts`
- Define a `CommandRegistry` interface with these methods:
  - `registerCommand(command: Command): void` - Add a command to the registry
  - `getCommand(name: string): Command | undefined` - Retrieve a command by name
  - `getAllCommands(): Command[]` - Get all registered commands
  - `getCommandsByGroup(group: string): Command[]` - Get commands belonging to a specific group
  - `hasCommand(name: string): boolean` - Check if a command exists
  - `removeCommand(name: string): boolean` - Remove a command from the registry

### Implement Command Registry Service

`src/domain/commandRegistry.service.ts`:
- Implement a `CommandRegistryService` class that implements the `CommandRegistry` interface
- Create a private Map to store commands by name
- Implement all the interface methods
- Add validation for command names (ensure uniqueness, proper formatting)
- Implement a simple event system to notify listeners when commands are added or removed
- Create helper methods for:
  - Finding commands by partial name
  - Grouping commands by namespace/category
  - Retrieving command hierarchies (parent/child relationships)
- Export a singleton instance of the registry service

### Create Command Group Utilities

`src/domain/commandGroup.util.ts`:
- Import the Command type and CommandRegistry interface
- Create utility functions to work with command groups:
  - `getCommandNamespace(commandName: string): string` - Extract the namespace part of a command
  - `groupCommandsByNamespace(commands: Command[]): Record<string, Command[]>` - Group commands by their namespace
  - `flattenCommandGroups(groups: CommandGroup[]): Command[]` - Convert nested command groups to a flat list
  - `findParentCommands(command: Command, registry: CommandRegistry): Command[]` - Find all parent commands

> End of programming instructions for task c1-f4-t5. 