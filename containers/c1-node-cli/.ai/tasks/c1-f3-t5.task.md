# Task 5 for Plan c1-f3

Create log context utilities for structured logging

**Layer**: system  
**Status**: not-started

### Reference

- [Feature Blueprint](/docs/f3-logging.blueprint.md)
- [Implementation Plan](/containers/c1-node-cli/docs/f3-logging.plan.md)
- [Language coding rules](/containers/c1-node-cli/.ai/rules/0-typescript.rules.md)  
- [Node CLI rules](/containers/c1-node-cli/.ai/rules/1-node-cli.rules.md)
- [System Layer rules](/containers/c1-node-cli/.ai/rules/2-system-layer.rules.md)

## Instructions

- `src/system/logger/logContext.type.ts` : Define context interfaces and types
  - Create an interface `LogContext` to store context data:
    - `correlationId: string` - Unique ID for tracking related log entries
    - `sessionId?: string` - Optional user/app session identifier
    - `timestamp: number` - When the context was created
    - `metadata: Record<string, unknown>` - Arbitrary contextual data
  - Define a type `LogContextMetadataKey` for common metadata keys
  - Create a function `createDefaultContext(): LogContext` that generates a new context with default values

- `src/system/logger/logContext.util.ts` : Implement context utilities
  - Create a function `generateCorrelationId(): string` for unique request IDs
  - Implement a function `createLogContext(metadata?: Record<string, unknown>): LogContext`
  - Create a function `enrichLogContext(context: LogContext, metadata: Record<string, unknown>): LogContext` that merges data
  - Implement a function `getContextValue<T>(context: LogContext, key: string, defaultValue?: T): T`
  - Create a function `serializeContext(context: LogContext): string` for context serialization

- `src/system/logger/asyncLocalStorage.util.ts` : Implement context propagation
  - Use Node.js AsyncLocalStorage to store and retrieve the current log context
  - Create a function `getLogContext(): LogContext | undefined` to access the current context
  - Implement a function `setLogContext(context: LogContext): void`
  - Create a function `withLogContext<T>(context: LogContext, callback: () => T): T` to run code with a specific context
  - Implement a function `clearLogContext(): void`

- `src/system/logger/index.ts` : Update the barrel file
  - Export all context types and utilities

> End of programming instructions for task 5. 