# Task 9 for Plan c1-f3

Create log aggregation utilities

**Layer**: domain  
**Status**: not-started

### Reference

- [Feature Blueprint](/docs/f3-logging.blueprint.md)
- [Implementation Plan](/containers/c1-node-cli/docs/f3-logging.plan.md)
- [Language coding rules](/containers/c1-node-cli/.ai/rules/0-typescript.rules.md)  
- [Node CLI rules](/containers/c1-node-cli/.ai/rules/1-node-cli.rules.md)
- [Domain Layer rules](/containers/c1-node-cli/.ai/rules/3-domain-layer.rules.md)

## Instructions

- `src/domain/logger/logAggregation.type.ts` : Define aggregation types
  - Create a type `LogAggregationType` as a union of string literals ('count', 'time', 'level', 'pattern')
  - Define an interface `LogAggregationOptions` with properties:
    - `type: LogAggregationType` - Type of aggregation to perform
    - `timeInterval?: string` - For time-based aggregation ('hourly', 'daily', etc.)
    - `pattern?: string | RegExp` - For pattern-based aggregation
    - `includeEmpty?: boolean` - Whether to include empty buckets
  - Create an interface `LogAggregationResult` with properties depending on aggregation type

- `src/domain/logger/logCounter.util.ts` : Implement counting functionality
  - Create a function `countLogsByLevel(entries: LogEntry[]): Record<string, number>`
  - Implement `countLogsByTimeInterval(entries: LogEntry[], interval: string): Record<string, number>`
  - Create a function `countLogsByPattern(entries: LogEntry[], pattern: string | RegExp): Record<string, number>`
  - Implement a general `countLogs(entries: LogEntry[], options: LogAggregationOptions): LogAggregationResult`

- `src/domain/logger/logStats.util.ts` : Implement statistical utilities
  - Create a function `calculateLogFrequency(entries: LogEntry[], timeInterval: string): Record<string, number>`
  - Implement `calculateErrorRate(entries: LogEntry[], timeInterval: string): number`
  - Create a function `findMostCommonPatterns(entries: LogEntry[], count?: number): Array<{pattern: string, count: number}>`
  - Implement `calculateAverageLogsPerMinute(entries: LogEntry[]): number`
  - Create a function `detectAnomalies(entries: LogEntry[], baseline?: LogEntry[]): LogEntry[]`

- `src/domain/logger/timeSeriesAnalysis.util.ts` : Implement time-based analysis
  - Create a function `groupLogsByTimeInterval(entries: LogEntry[], interval: string): Record<string, LogEntry[]>`
  - Implement `calculateTrend(entries: LogEntry[], metric: string, interval: string): Array<{time: string, value: number}>`
  - Create a function `compareTimePeriods(current: LogEntry[], previous: LogEntry[], metric: string): {change: number, percentage: number}`

- `src/domain/logger/index.ts` : Update the barrel file
  - Export all aggregation types and utilities

> End of programming instructions for task 9. 