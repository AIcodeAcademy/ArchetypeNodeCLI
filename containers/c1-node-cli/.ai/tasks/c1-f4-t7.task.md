# Task 7 for Plan c1-f4

Create a service to execute commands with the appropriate arguments and handle the results.

**Layer**: domain  
**Status**: not-started

### Reference

- [Feature Blueprint](/docs/f4-command-handling.blueprint.md)
- [Implementation Plan](/containers/c1-node-cli/docs/f4-command-handling.plan.md)
- [Language coding rules](/containers/c1-node-cli/.ai/rules/0-typescript.rules.md)  
- [Node CLI rules](/containers/c1-node-cli/.ai/rules/1-node-cli.rules.md)
- [Domain Layer rules](/containers/c1-node-cli/.ai/rules/3-domain-layer.rules.md)

## Instructions

### Create Command Execution Types

`src/domain/commandExecution.types.ts`:
- Import command types from the system layer
- Define an `ExecutionContext` interface with:
  - `command: Command` - The command being executed
  - `args: string[]` - Provided arguments
  - `options: Record<string, any>` - Provided options
  - `environment: Record<string, string>` - Environment variables
- Define `CommandMiddleware` type for middleware functions that can intercept and modify command execution:
  - `(context: ExecutionContext, next: () => Promise<CommandResult>) => Promise<CommandResult>`

### Implement Command Executor Service

`src/domain/commandExecutor.service.ts`:
- Import the command types, command result types, and execution types
- Create a `CommandExecutorService` class with:
  - A method to register middleware: `use(middleware: CommandMiddleware): void`
  - The core execution method: `execute(command: Command, args: string[], options: Record<string, any>): Promise<CommandResult>`
  - Error handling for command execution
  - A method to create execution contexts: `createContext(command: Command, args: string[], options: Record<string, any>): ExecutionContext`
- Implement the middleware execution pipeline:
  - Chain middleware functions in the order they were registered
  - Allow middleware to intercept, modify, or bypass command execution
  - Handle errors at each middleware step
- Export a singleton instance of the executor service

### Create Command Exception Handling

`src/domain/commandException.util.ts`:
- Define command-specific error types:
  - `CommandExecutionError` for errors during command execution
  - `CommandValidationError` for validation failures
  - `CommandNotFoundError` for missing commands
- Implement utility functions:
  - `handleCommandError(error: Error): CommandResult` - Convert errors to command results
  - `isCommandError(error: Error): boolean` - Type guard for command errors
  - `createCommandError(message: string, code: string): CommandExecutionError` - Factory for command errors

> End of programming instructions for task c1-f4-t7. 