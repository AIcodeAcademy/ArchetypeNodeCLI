---
syntax: "[Template Syntax](/.ai/syntax.template.md)"
task: "Create environment service"
folder: "/containers/c1-node-cli/.ai/tasks"
file: "c1-f1-t5.task.md"
---

# Task 5 for Plan c1-f1

Create the main service for environment management and loading.

**Layer**: domain  
**Status**: not-started

### Reference

- [Feature Blueprint](/docs/f1-environment-management.blueprint.md)
- [Implementation Plan](/containers/c1-node-cli/docs/f1-environment-management.plan.md)
- [General coding rules](/containers/c1-node-cli/.ai/rules/0-typescript.rules.md)  
- [Node CLI archetype rules](/containers/c1-node-cli/.ai/rules/1-node-cli.rules.md)
- [Domain layer rules](/containers/c1-node-cli/.ai/rules/domain.rules.md)

## Instructions

- `src/domain/services/environment.service.ts` : Main logic for environment management
  - Create a class `EnvironmentService` with methods:
    - `initialize(context: EnvironmentContext): Promise<void>`
    - `getMode(): EnvironmentMode`
    - `getVariable(key: string): string | undefined`
    - `getAllVariables(): Record<string, string>`
    - `setVariable(key: string, value: string): void`
  - Implement proper error handling and validation
  - Use dependency injection for repositories and validators

- `src/domain/services/env-loader.service.ts` : Load and merge environment variables
  - Create a class `EnvLoaderService` with methods:
    - `loadEnvFiles(files: string[]): Promise<Record<string, string>>`
    - `mergeEnvSources(...sources: Record<string, string>[]): Record<string, string>`
    - `validateEnvVariables(variables: Record<string, string>): void`
  - Implement proper error handling and validation
  - Use the transformer utility for merging variables

> End of programming instructions for task 5. 