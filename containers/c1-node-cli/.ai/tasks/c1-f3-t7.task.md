# Task 7 for Plan c1-f3

Create log repository interface and implementation

**Layer**: domain  
**Status**: not-started

### Reference

- [Feature Blueprint](/docs/f3-logging.blueprint.md)
- [Implementation Plan](/containers/c1-node-cli/docs/f3-logging.plan.md)
- [Language coding rules](/containers/c1-node-cli/.ai/rules/0-typescript.rules.md)  
- [Node CLI rules](/containers/c1-node-cli/.ai/rules/1-node-cli.rules.md)
- [Domain Layer rules](/containers/c1-node-cli/.ai/rules/3-domain-layer.rules.md)

## Instructions

- `src/domain/logger/logRepository.type.ts` : Define repository interface
  - Create an interface `LogRepository` with the following methods:
    - `save(entry: LogEntry): Promise<LogEntry>` - Persist a log entry
    - `findById(id: string): Promise<LogEntry | undefined>` - Find a specific log entry
    - `findByCorrelationId(correlationId: string): Promise<LogEntry[]>` - Find related entries
    - `query(criteria: LogQueryCriteria): Promise<LogEntry[]>` - Find entries matching criteria
    - `count(criteria?: LogQueryCriteria): Promise<number>` - Count entries matching criteria
    - `clear(criteria?: LogQueryCriteria): Promise<number>` - Remove entries matching criteria
  - Define a type `LogQueryCriteria` with optional filter fields:
    - `level?: LogLevel | LogLevel[]`
    - `startTime?: number`
    - `endTime?: number`
    - `correlationId?: string`
    - `message?: string` (for text search)
    - `limit?: number`
    - `offset?: number`
    - `sortBy?: string`
    - `sortDirection?: 'asc' | 'desc'`

- `src/domain/logger/inMemoryLogRepository.ts` : Create in-memory implementation
  - Create a class `InMemoryLogRepository` implementing the `LogRepository` interface
  - Use an in-memory array to store log entries
  - Implement all required methods with proper filtering and sorting
  - Ensure immutability of returned objects

- `src/domain/logger/fileSystemLogRepository.ts` : Create file system implementation
  - Create a class `FileSystemLogRepository` implementing the `LogRepository` interface
  - Use the file system to store log entries as JSON files
  - Implement efficient querying with indexes
  - Handle file system errors properly

- `src/domain/logger/logRepositoryFactory.ts` : Create factory for repositories
  - Implement a function `createLogRepository(type: 'memory' | 'file', options?: any): LogRepository`
  - Add proper configuration for each repository type

- `src/domain/logger/index.ts` : Update the barrel file
  - Export all repository types and implementations

> End of programming instructions for task 7. 